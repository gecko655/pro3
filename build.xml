<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project basedir="." default="build" name="pro3-2014">
    <property environment="env"/>
    <property name="debuglevel" value="source,lines,vars"/>
    <property name="target" value="1.7"/>
    <property name="source" value="1.7"/>

	<property name="SERVADDR" value="localhost" />

    <path id="pro3-2014.classpath">
        <pathelement location="bin"/>
    </path>

    <path id="pro3-2014-ex4.classpath">
        <pathelement location="bin"/>
        <pathelement location="lib/kuromoji-0.7.7.jar"/>
    </path>

    <target name="init">
        <mkdir dir="bin"/>
        <copy includeemptydirs="false" todir="bin">
            <fileset dir="src">
                <exclude name="**/*.java"/>
            </fileset>
        </copy>
    </target>

	<!-- Delete class files -->
    <target name="clean">
        <delete dir="bin"/>
    </target>

	<!-- Delete generated Javadoc files -->
	<target name="clean-doc" if="have.javadoc">
		<delete>
			<fileset dir="javadoc" />
		</delete>
	</target>

	<!-- Delete resource fork files generated by MacOS -->
	<target name="clean-resource-forks">
		<delete verbose="true">
			<fileset dir="src" defaultexcludes="no">
				<include name="**/._*" />
				<include name="**/.DS_Store" />
			</fileset>
		</delete>
	</target>

	<!-- Run clean-* -->
    <target name="clean-all" depends="clean,clean-doc,clean-resource-forks"/>


	<target name="javadoc" depends="javadoc-csc-proxy"/>

	<target name="javadoc-csc-proxy" depends="clean">
		<javadoc destdir="./javadoc" encoding="utf-8" access="package" use="true" version="true" windowtitle="${ant.project.name} javadoc" additionalparam="-J-Dhttp.proxyHost=proxy.csc.titech.ac.jp -J-Dhttp.proxyPort=8080">
			<package name="*" />
			<sourcepath path="./src" />
			<classpath refid="pro3-2014.classpath" />
			<link href="http://docs.oracle.com/javase/7/docs/api" />
		</javadoc>
	</target>
	<target name="javadoc-direct" depends="clean">
		<javadoc destdir="./javadoc" encoding="utf-8" access="package" use="true" version="true" windowtitle="${ant.project.name} javadoc">
			<package name="*" />
			<sourcepath path="./src" />
			<classpath refid="pro3-2014.classpath" />
			<link href="http://docs.oracle.com/javase/7/docs/api" />
		</javadoc>
	</target>


    <target name="build" depends="build-2014ex" />

    <target name="build-2014ex" depends="init" >
        <echo message="${ant.project.name}: ${ant.file}"/>
        <javac debug="true" debuglevel="${debuglevel}" destdir="bin" includeantruntime="false" source="${source}" target="${target}" encoding="UTF-8">
            <src path="src"/>
            <classpath refid="pro3-2014-ex4.classpath"/>
        </javac>
	</target>

	<!--
	  - Run each programs
	  -
	  - -->
	<!-- EX3 -->
    <target name="AccountNaive">
        <java classname="pro3.ex3.AccountNaive" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>
    <target name="AccountWithVolatile">
        <java classname="pro3.ex3.AccountWithVolatile" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>
    <target name="AccountWithSynchronized">
        <java classname="pro3.ex3.AccountWithSynchronized" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>
    <target name="AccountAll" depends="AccountNaive,AccountWithVolatile,AccountWithSynchronized"/>

	<target name="Drawing3">
        <java classname="pro3.ex3.Drawing3" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>
	<target name="SimpleCalculator">
        <java classname="pro3.ex3.SimpleCalculator" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>

    <!-- EX4 -->
    <property name="scale" value="5"/>
    <property name="th" value="3"/>
    <target name="TweetAnalyzerOriginal">
        <java classname="pro3.ex4.TweetAnalyzerOriginal" failonerror="true" fork="yes">
            <classpath refid="pro3-2014-ex4.classpath"/>
	    <arg value="${scale}"/>
        </java>
    </target>
    <target name="TweetAnalyzerMT">
        <java classname="pro3.ex4.TweetAnalyzerMT" failonerror="true" fork="yes">
            <classpath refid="pro3-2014-ex4.classpath"/>
	    <arg value="${scale}"/>
	    <arg value="${th}"/>

        </java>
    </target>

    <target name="TaskProducer">
        <java classname="pro3.ex4.TaskProducer" failonerror="true" fork="yes">
            <classpath refid="pro3-2014-ex4.classpath"/>
        </java>
    </target>

	<!-- EX5 -->
	<target name="TC1">
        <java classname="pro3.ex5.TestClient1" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>
	<target name="TC2">
        <java classname="pro3.ex5.TestClient2" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>
	<target name="TC2Java7">
        <java classname="pro3.ex5.TestClient2Java7" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>
	<target name="TS0">
        <java classname="pro3.ex5.TestServer0" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>
	<target name="TS1">
        <java classname="pro3.ex5.TestServer1" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>
    <target name="TS2">
        <java classname="pro3.ex5.TestServer2" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>

    <property name="pattern" value="pattern1.txt"/>
    <property name="workers" value="3"/>
    <target name="PE"  depends="build">
        <java classname="pro3.ex6.PerformanceEvaluator" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
	    <arg value="${pattern}"/>
	    <arg value="${workers}"/>
        </java>
    </target>

    <target name="WTC"  depends="build">
        <java classname="pro3.ex6.WTClient" failonerror="true" fork="yes">
            <classpath refid="pro3-2014.classpath"/>
        </java>
    </target>


</project>
